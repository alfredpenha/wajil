---
const { brand, navigation, uberEats } = Astro.props;
---
<header class="sticky top-0 z-50 border-b border-fog/10 bg-ink/85 backdrop-blur">
  <div class="mx-auto flex max-w-6xl items-center justify-between px-6 py-4 md:px-12">
    <a href="#inicio" class="text-sm font-semibold tracking-[0.4em] text-gold transition hover:text-sand">
      {brand.logo}
    </a>
    <nav class="hidden items-center gap-6 text-sm uppercase tracking-[0.12em] text-sand/70 md:flex" aria-label="Secciones">
      {navigation.map((item) => (
          <a class="transition hover:text-gold" href={item.href}>{item.label}</a>
        ))}
      </nav>
    <a
      class="btn-gold hidden text-[10px] md:inline-flex"
      href={uberEats.href}
      data-track="click_ubereats_header"
    >
      {uberEats.label}
    </a>
  </div>
</header>

<div
  class="sticky-cta fixed bottom-0 left-0 right-0 z-50 translate-y-full border-t border-fog/15 bg-ink/95 px-6 py-3 pb-[env(safe-area-inset-bottom)] opacity-0 transition-transform duration-300 transition-opacity backdrop-blur md:hidden"
  data-sticky-cta
>
  <a
    class="btn-gold w-full"
    href={uberEats.href}
    data-track="click_ubereats_bottom"
  >
    {uberEats.label}
  </a>
</div>

<script is:inline>
  const initSticky = () => {
    const sticky = document.querySelector('[data-sticky-cta]');
    const hero = document.querySelector('#inicio');

    const showSticky = () => {
      if (!sticky) return;
      sticky.classList.remove('translate-y-full', 'opacity-0');
      sticky.classList.add('translate-y-0', 'opacity-100');
    };

    const hideSticky = () => {
      if (!sticky) return;
      sticky.classList.add('translate-y-full', 'opacity-0');
      sticky.classList.remove('translate-y-0', 'opacity-100');
    };

    if (sticky && hero && 'IntersectionObserver' in window) {
      const observer = new IntersectionObserver(
        ([entry]) => {
          if (entry.isIntersecting) {
            hideSticky();
          } else {
            showSticky();
          }
        },
        { threshold: 0.2 }
      );
      observer.observe(hero);
    } else if (sticky) {
      showSticky();
    }
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSticky);
  } else {
    initSticky();
  }
</script>
