---
import { baseFromPath, buildSrcset, withBase } from '../../lib/images';

const { products, uberEats } = Astro.props;
const productWidths = [480, 720];
---
<section id="producto" class="border-t border-fog/10 px-6 py-16 md:px-12">
  <div class="mx-auto max-w-6xl">
    <div class="mb-10 space-y-3">
      <h2 class="text-2xl font-semibold text-sand md:text-3xl">{products.title}</h2>
      <p class="max-w-2xl text-sm text-fog md:text-base">{products.intro}</p>
    </div>

    <div class="flex snap-x snap-mandatory gap-6 overflow-x-auto pb-6 md:grid md:grid-cols-3 md:overflow-visible fade-up">
      {products.items.map((item) => {
        const base = baseFromPath(item.image.fallback);
        const avif = buildSrcset(base, productWidths, 'avif');
        const webp = buildSrcset(base, productWidths, 'webp');
        const jpg = buildSrcset(base, productWidths, 'jpg');
        const fallback = withBase(item.image.fallback);
        return (
        <article class="flex min-w-[240px] snap-start flex-col rounded-3xl border border-fog/15 bg-ink/70 p-4 shadow-soft md:min-w-0 md:h-full">
          <picture>
            <source srcset={avif} sizes="(min-width: 1024px) 30vw, (min-width: 768px) 45vw, 70vw" type="image/avif" />
            <source srcset={webp} sizes="(min-width: 1024px) 30vw, (min-width: 768px) 45vw, 70vw" type="image/webp" />
            <img
              class="aspect-[4/3] w-full rounded-3xl object-cover"
              src={fallback}
              alt={item.image.alt}
              width="1024"
              height="1024"
              srcset={jpg}
              sizes="(min-width: 1024px) 30vw, (min-width: 768px) 45vw, 70vw"
              loading="lazy"
              decoding="async"
            />
          </picture>
          <div class="mt-4 flex flex-1 flex-col gap-2">
            <h3 class="text-lg font-semibold text-sand">{item.title}</h3>
            <p class="text-[15px] leading-relaxed text-sand/70">{item.copy}</p>
            <a
              class="mt-3 inline-flex items-center gap-2 self-start rounded-full border border-gold/40 px-3 py-1.5 text-[10px] uppercase tracking-[0.25em] text-gold transition hover:border-gold hover:bg-gold/10 hover:text-sand"
              href={uberEats.href}
            >
              {item.linkLabel}
              <svg class="h-3.5 w-3.5" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M5 11L11 5" />
                <path d="M6 5h5v5" />
              </svg>
            </a>
          </div>
        </article>
        );
      })}
    </div>

    <div class="mt-8 fade-up">
      <a
        class="btn-gold"
        href={uberEats.href}
        data-track="click_ubereats_products"
      >
        {products.ctaLabel}
      </a>
    </div>
  </div>
</section>
