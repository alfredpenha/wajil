---
import { AnalyticsEvents } from '../../lib/analytics';
import { baseFromPath, buildSrcset, withBase } from '../../lib/images';
import ButtonGold from '../ui/ButtonGold.astro';
import Card from '../ui/Card.astro';
import PillLink from '../ui/PillLink.astro';

const { products, uberEats } = Astro.props;
const productWidths = [480, 720];
---
<section id="producto" class="section-x border-t border-fog/10 py-16">
  <div class="section-inner">
    <div class="mb-10 space-y-3">
      <h2 class="section-title">{products.title}</h2>
      <p class="max-w-2xl text-sm text-fog md:text-base">{products.intro}</p>
    </div>

    <div class="flex snap-x snap-mandatory gap-6 overflow-x-auto pb-6 md:grid md:grid-cols-3 md:overflow-visible fade-up">
      {products.items.map((item) => {
        const base = baseFromPath(item.image.fallback);
        const avif = buildSrcset(base, productWidths, 'avif');
        const webp = buildSrcset(base, productWidths, 'webp');
        const jpg = buildSrcset(base, productWidths, 'jpg');
        const fallback = withBase(item.image.fallback);
        return (
        <Card as="article" class="flex min-w-[240px] snap-start flex-col bg-ink/70 p-4 md:min-w-0 md:h-full">
          <picture>
            <source srcset={avif} sizes="(min-width: 1024px) 30vw, (min-width: 768px) 45vw, 70vw" type="image/avif" />
            <source srcset={webp} sizes="(min-width: 1024px) 30vw, (min-width: 768px) 45vw, 70vw" type="image/webp" />
            <img
              class="aspect-[4/3] w-full rounded-card object-cover"
              src={fallback}
              alt={item.image.alt}
              width="1024"
              height="1024"
              srcset={jpg}
              sizes="(min-width: 1024px) 30vw, (min-width: 768px) 45vw, 70vw"
              loading="lazy"
              decoding="async"
            />
          </picture>
          <div class="mt-4 flex flex-1 flex-col gap-2">
            <h3 class="text-lg font-semibold text-sand">{item.title}</h3>
            <p class="text-[15px] leading-relaxed text-sand/70">{item.copy}</p>
            <PillLink href={uberEats.href} ariaLabel={`${item.linkLabel} - Producto`}>
              {item.linkLabel}
            </PillLink>
          </div>
        </Card>
        );
      })}
    </div>

    <div class="mt-8 fade-up">
      <ButtonGold
        href={uberEats.href}
        dataTrack={AnalyticsEvents.uberEatsProducts}
        ariaLabel={`${products.ctaLabel} - Productos`}
      >
        {products.ctaLabel}
      </ButtonGold>
    </div>
  </div>
</section>
